# Qt 版本变更说明

## ⚠️ 重要变更：从 Qt 5.15.2 切换到 Qt 5.12.12

### 变更原因

经过实际测试和调查发现：

1. ✅ **Qt 5.12.12 不需要 TLS 后端插件**
   - 可以直接使用 OpenSSL DLL
   - 无需 `qopensslbackend.dll` 插件
   - 简化部署流程

2. ❌ **Qt 5.15.2 强制要求 TLS 插件**
   - 需要 `qopensslbackend.dll` 插件才能使用 HTTPS
   - Qt 官方分发版不包含此插件
   - 需要自行编译或获取插件（复杂且不可靠）

### 解决方案

**降级到 Qt 5.12.12**，这是最后一个不强制要求 TLS 插件的 LTS 版本。

## 技术细节

### Qt SSL/TLS 架构演变

- **Qt 5.12 及更早**: 直接使用 OpenSSL DLL，无需插件
- **Qt 5.15.0-5.15.2**: 过渡期，引入插件系统但未强制
- **Qt 5.15.3+**: 完全依赖 TLS 后端插件系统
- **Qt 6.x**: 强制要求插件系统

### 为什么选择 Qt 5.12.12？

1. ✅ **稳定性**
   - LTS（Long Term Support）版本
   - 成熟稳定，bug 少

2. ✅ **兼容性**
   - 向后兼容性好
   - 现有代码无需大改

3. ✅ **SSL 支持**
   - 直接使用 OpenSSL DLL
   - 无需插件，部署简单

4. ✅ **可靠性**
   - 经过大量实际项目验证
   - GitHub Actions 支持良好

## 变更内容

### GitHub Actions 工作流

```yaml
# 之前（不工作）
aqt install-qt windows desktop 5.15.2 win64_msvc2019_64

# 现在（应该工作）
aqt install-qt windows desktop 5.12.12 win64_msvc2017_64
```

### CMake 配置

```cmake
# 添加了工具集指定
-T v141  # 使用 VS 2017 工具集
```

### 应用代码

添加了 OpenSSL DLL 预加载逻辑，确保 Qt 能找到它们。

## 预期结果

✅ **构建后应该：**
- SSL 支持完全启用
- HTTPS 请求正常工作
- 无需任何插件文件
- 部署简单可靠

## 兼容性说明

### API 兼容性

Qt 5.12 和 5.15 的 API 高度兼容，现有代码无需修改。

### 功能影响

- ✅ 网络功能：完全兼容
- ✅ SSL/TLS：完全支持
- ✅ 界面：无影响
- ✅ 其他模块：无影响

## 测试要点

1. **编译测试**
   - 确认使用 Qt 5.12.12 编译成功
   - 检查构建日志中的 Qt 版本

2. **SSL 测试**
   - 启动应用，查看 "SSL 支持: true"
   - 测试 HTTPS 请求
   - 验证数据上传功能

3. **兼容性测试**
   - 测试所有功能模块
   - 确认无回归问题

## 回滚方案

如果 Qt 5.12.12 遇到问题，可以：

1. 使用本地完整的 Qt 5.15.2 安装（包含插件）
2. 或者手动编译 Qt 5.15.2 的 TLS 插件
3. 或者使用 Qt 6.x（需要更多代码调整）

## 总结

- 🎯 **问题根源**：Qt 5.15.2 需要 TLS 插件但官方不提供
- ✅ **解决方案**：降级到 Qt 5.12.12
- 🚀 **优势**：简单、可靠、无需插件
- ⚠️ **注意**：Qt 5.12 是 LTS 版本，支持到 2021 年底（已结束），但仍然稳定可用

---

**日期**: 2025-01-05  
**状态**: ✅ 已实施，等待测试验证  
**影响**: 应该完全解决 HTTPS 问题

